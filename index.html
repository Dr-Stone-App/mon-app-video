<script>
    let jetons = 5;
    let creations = 3;

    // BIBLIOTHÃˆQUE DE THÃˆMES (VidÃ©os gratuites de haute qualitÃ©)
    const bibliotheque = {
        "robot": "https://assets.mixkit.co/videos/preview/mixkit-futuristic-robot-dancing-in-a-dark-room-43402-large.mp4",
        "nature": "https://assets.mixkit.co/videos/preview/mixkit-beautiful-aerial-view-of-a-forest-and-mountains-1533-large.mp4",
        "espace": "https://assets.mixkit.co/videos/preview/mixkit-stars-in-the-space-1604-large.mp4",
        "tech": "https://assets.mixkit.co/videos/preview/mixkit-digital-animation-of-a-circuit-board-1540-large.mp4",
        "cyberpunk": "https://assets.mixkit.co/videos/preview/mixkit-city-traffic-at-night-with-neon-lights-2483-large.mp4",
        "anime": "https://assets.mixkit.co/videos/preview/mixkit-female-anime-character-in-the-rain-48766-large.mp4",
        "sport": "https://assets.mixkit.co/videos/preview/mixkit-man-training-in-the-gym-4801-large.mp4",
        "ocean": "https://assets.mixkit.co/videos/preview/mixkit-waves-coming-to-the-shore-line-1538-large.mp4",
        "defaut": "https://assets.mixkit.co/videos/preview/mixkit-abstract-fast-motion-light-trails-34255-large.mp4"
    };

    function showApp() {
        document.getElementById('splash-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
    }

    function toggleDark() {
        document.getElementById('body').classList.toggle('dark-mode');
        document.getElementById('card').classList.toggle('dark-card');
    }

    function openProfile() {
        document.getElementById('profile-modal').classList.remove('hidden');
    }

    function saveProfile() {
        const newName = document.getElementById('edit-name').value;
        document.getElementById('user-name').innerText = newName;
        document.getElementById('profile-modal').classList.add('hidden');
        notify("Profil mis Ã  jour ! âœ…");
    }

    function notify(msg) {
        const n = document.getElementById('notification');
        document.getElementById('note-msg').innerText = msg;
        n.classList.add('show-note');
        setTimeout(() => n.classList.remove('show-note'), 3000);
    }

    function addTokens() {
        jetons += 3;
        document.getElementById('credits').innerText = `ðŸª™ ${jetons}`;
        notify("Bonus ajoutÃ© ! +3 ðŸª™");
    }

    function viewImage(src) {
        const modal = document.createElement('div');
        modal.className = "fixed inset-0 bg-black/90 z-[300] flex items-center justify-center p-4 cursor-pointer";
        modal.innerHTML = `<img src="${src}" class="max-w-full max-h-full rounded-2xl shadow-2xl scale-100 transition-all duration-300">`;
        modal.onclick = () => modal.remove();
        document.body.appendChild(modal);
    }

    function startProcess() {
        const promptRaw = document.getElementById('prompt').value;
        const prompt = promptRaw.toLowerCase();
        const isTurbo = document.getElementById('turbo-mode').checked;
        const prix = isTurbo ? 2 : 1;
        const temps = isTurbo ? 2000 : 5000;

        if (jetons < prix) {
            notify("Plus de jetons ! ðŸŽ");
            return;
        }

        // DÃ©duction
        jetons -= prix;
        creations++;
        document.getElementById('credits').innerText = `ðŸª™ ${jetons}`;
        document.getElementById('total-vids').innerText = creations;

        const btn = document.getElementById('btn-gen');
        const pBar = document.getElementById('p-bar');
        
        btn.disabled = true;
        btn.innerText = "SYNTHÃˆSE EN COURS...";
        document.getElementById('p-container').classList.remove('hidden');
        pBar.className = "h-full bg-blue-500"; 
        void pBar.offsetWidth; 
        pBar.classList.add(isTurbo ? 'progress-turbo' : 'progress-fill');

        // LOGIQUE DE SÃ‰LECTION DE LA VIDÃ‰O
        let videoChoisie = bibliotheque["defaut"];
        if(prompt.includes("robot") || prompt.includes("futur")) videoChoisie = bibliotheque["robot"];
        else if(prompt.includes("nature") || prompt.includes("forÃªt") || prompt.includes("montagne")) videoChoisie = bibliotheque["nature"];
        else if(prompt.includes("espace") || prompt.includes("Ã©toile") || prompt.includes("planÃ¨te")) videoChoisie = bibliotheque["espace"];
        else if(prompt.includes("tech") || prompt.includes("code") || prompt.includes("ordi")) videoChoisie = bibliotheque["tech"];
        else if(prompt.includes("cyberpunk") || prompt.includes("ville") || prompt.includes("nuit")) videoChoisie = bibliotheque["cyberpunk"];
        else if(prompt.includes("anime") || prompt.includes("manga") || prompt.includes("dessin")) videoChoisie = bibliotheque["anime"];
        else if(prompt.includes("sport") || prompt.includes("muscu") || prompt.includes("gym")) videoChoisie = bibliotheque["sport"];
        else if(prompt.includes("ocÃ©an") || prompt.includes("mer") || prompt.includes("plage")) videoChoisie = bibliotheque["ocean"];

        setTimeout(() => {
            document.getElementById('status').classList.add('hidden');
            const video = document.getElementById('demo-video');
            video.src = videoChoisie; // Changement de la vidÃ©o selon le prompt
            video.classList.remove('hidden');
            video.play();

            // VOIX OFF : Lit le texte Ã©crit par l'utilisateur
            if ('speechSynthesis' in window) {
                const narration = new SpeechSynthesisUtterance(promptRaw);
                narration.lang = 'fr-FR';
                narration.rate = 0.9; // Un peu plus lent pour faire pro
                window.speechSynthesis.speak(narration);
            }

            document.getElementById('actions').classList.remove('hidden');
            btn.innerText = "TERMINÃ‰ ! âœ¨";
            btn.style.backgroundColor = "#22c55e";
            notify("VidÃ©o gÃ©nÃ©rÃ©e avec Voix Off ! ðŸŽ¬");
        }, temps);
    }
</script>
